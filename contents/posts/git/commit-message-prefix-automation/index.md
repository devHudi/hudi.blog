---
title: "Git Hooksë¥¼ ì‚¬ìš©í•œ ì»¤ë°‹ ë©”ì‹œì§€ Prefix ìë™í™”"
date: 2023-07-01 23:15:00
tags:
  - í•™ìŠµê¸°ë¡
  - git
---

ì‚¬ì´ë“œ í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í•˜ë©°, ê°„ë‹¨í•œ ì´ìŠˆ íŠ¸ë˜í‚¹ì„ ìœ„í•´ Github Issueë¥¼ ì‚¬ìš©í•˜ê³  ìˆë‹¤. ê°œë°œì„ í•˜ë‹¤ ë³´ë©´, ì´ì „ì˜ ì»¤ë°‹ì´ ì–´ë–¤ ì´ìŠˆë¥¼ í•´ê²°í•˜ê¸° ìœ„í•œ ì‘ì—…ì´ì—ˆëŠ”ì§€ ë°°ê²½ì„ íŒŒì•…í•  í•„ìš”ê°€ ìˆë‹¤. ë”°ë¼ì„œ ë‚˜ëŠ” ì»¤ë°‹ê³¼ ì—°ê´€ëœ ì´ìŠˆë¥¼ íŒŒì•…í•˜ê¸° ì‰½ë„ë¡ **ì´ìŠˆ í‹°ì¼“ ë²ˆí˜¸ë¥¼ ì»¤ë°‹ ë©”ì‹œì§€ Prefix**ë¡œ ë‘ëŠ” ê²ƒì„ ì„ í˜¸í•œë‹¤. í•˜ì§€ë§Œ ì¼ì¼íˆ ì´ìŠˆ í‹°ì¼“ ë²ˆí˜¸ë¥¼ ì‚¬ëŒì´ ì»¤ë°‹ ë©”ì‹œì§€ì— ì‘ì„±í•˜ë©´, **ëˆ„ë½í•˜ê±°ë‚˜ ì‹¤ìˆ˜í•  ìœ„í—˜**ì´ ìˆë‹¤.

Gitì€ Git Hooksë¼ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤. ì´ë¥¼ ì´ìš©í•˜ì—¬ ì»¤ë°‹ ë©”ì‹œì§€ì— ìë™ìœ¼ë¡œ Prefixë¥¼ ë‹¬ì•„ë³´ë ¤ê³  í•œë‹¤. ë¨¼ì € Git Hooksê°€ ë¬´ì—‡ì¸ì§€ì— ëŒ€í•´ ì•Œì•„ë³´ì.

## Git Hooks

Git HooksëŠ” Git ë ˆí¬ì§€í† ë¦¬ ë‚´ì—ì„œ **íŠ¹ì • ì´ë²¤íŠ¸**ê°€ ë°œìƒí•˜ë©´, **ìë™ìœ¼ë¡œ íŠ¹ì • ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰**í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤.

![ê¸°ë³¸ ìƒì„±ëœ Git Hooks ìƒ˜í”Œë“¤](1.png)

Git Hooks ìŠ¤í¬ë¦½íŠ¸ëŠ” ëª¨ë“  Git ë ˆí¬ì§€í† ë¦¬ì— ê¸°ë³¸ì ìœ¼ë¡œ ì¡´ì¬í•œë‹¤. ë‹¤ë§Œ `.sample` í™•ì¥ìë¡œ ì¸í•´ ì‹¤ì œë¡œëŠ” ì‹¤í–‰ë˜ì§€ ì•Šê³  ìˆëŠ” ìƒí™©ì´ë‹¤. ìœ„ ì²˜ëŸ¼ Git HooksëŠ” ë§ì€ ì´ë²¤íŠ¸ë¥¼ ì œê³µí•œë‹¤. ìš°ë¦¬ëŠ” ì´ ì¤‘ `prepare-commit-msg` í›…ì„ ì‚¬ìš©í•  ê²ƒì´ë‹¤.

### prepare-commit-msg

ì´ í›…ì€ pre-commit í›… ì´í›„ì— ì‹¤í–‰ë˜ë©°, ì»¤ë°‹ ì‹œ ì œê³µëœ ì»¤ë°‹ ë©”ì‹œì§€ë¥¼ ìˆ˜ì •í•  ìˆ˜ ìˆë‹¤. ë” ìì„¸í•˜ê²Œ ì´ì•¼ê¸°í•´ë³´ìë©´, prepare-commit-msg ëŠ” **ê¸°ë³¸ ì»¤ë°‹ ë©”ì‹œì§€ê°€ ìƒì„±ëœ ì´í›„, ì»¤ë°‹ ë©”ì‹œì§€ í¸ì§‘ê¸°ê°€ ì‹¤í–‰ë˜ê¸° ì´ì „ ì‹œì **ì— ì‹¤í–‰ëœë‹¤.

prepare-commit-msgëŠ” ì•„ë˜ì˜ **1~3ê°œì˜ íŒŒë¼ë¯¸í„°**ë¥¼ ë°›ëŠ”ë‹¤. íŒŒë¼ë¯¸í„° ìˆœì„œëŒ€ë¡œ ë‚˜ì—´í•˜ë©´ ì•„ë˜ì™€ ê°™ë‹¤.

1. **COMMIT_EDITMSG íŒŒì¼ ì´ë¦„**: `COMMIT_EDITMSG` íŒŒì¼ì´ë€, ìš°ë¦¬ê°€ í”íˆ `git commit` ëª…ë ¹ì„ ì‹¤í–‰í–ˆì„ ë•Œ ì»¤ë°‹ ë©”ì‹œì§€ ì‘ì„±ì„ ìœ„í•´ í¸ì§‘í•˜ê²Œ ë˜ëŠ” íŒŒì¼ì´ë‹¤. ê¸°ë³¸ì ìœ¼ë¡œëŠ” **./git/COMMIT_EDITMSG** ì— ìƒì„±ëœë‹¤.

   ![COMMIT_EDITMSG](2.png)

2. **ì»¤ë°‹ ë©”ì‹œì§€ì˜ ì¶œì²˜(Source of the Commit Message)**: ì»¤ë°‹ ë©”ì‹œì§€ê°€ ì–´ë””ì„œ ì™”ëŠ”ì§€ ì•Œ ìˆ˜ ìˆë‹¤. ê·¸ ê°’ì€ ì•„ë˜ì™€ ê°™ë‹¤.
   - **message**: -m í˜¹ì€ -F ì˜µì…˜ì´ ì£¼ì–´ì¡Œì„ ë•Œ
   - **template**: -t ì˜µì…˜ì´ ì£¼ì–´ì¡Œê±°ë‚˜ í˜¹ì€ `commit.template` ì„¤ì •ì´ ìˆì„ ë•Œ
   - **merge**: ë¨¸ì§€ ì»¤ë°‹ì¼ ë•Œ í˜¹ì€ `.git/MERGE_MSG` íŒŒì¼ì´ ìˆì„ ë•Œ
   - **squash**: `.git/SQUASH_MSG` íŒŒì¼ì´ ìˆì„ ë•Œ
   - **commit**: ìœ„ì— í•´ë‹¹ë˜ì§€ ì•ŠëŠ” ê²½ìš°
3. **ì»¤ë°‹ SHA-1**: ì •í™•íˆëŠ” commit object nameì„ ë‚˜íƒ€ë‚¸ë‹¤. `-c`,Â `-C`Â í˜¹ì€Â `--amend` ì˜µì…˜ì´ ìˆì„ ë•Œë§Œ ì£¼ì–´ì§„ë‹¤.

> ğŸ’¡Â **ì°¸ê³ **: ì´ í›…ì˜ Exit Statusê°€ 0ì´ ì•„ë‹Œ ê²½ìš°, Gitì€ ì§„í–‰ì¤‘ì¸ ì»¤ë°‹ì„ abort í•œë‹¤.

## ì§ì ‘ í›… ì‘ì„±í•˜ê¸°

ë‚´ ì‚¬ì´ë“œ í”„ë¡œì íŠ¸ ë¸Œëœì¹˜ ë„¤ì´ë° ì»¨ë²¤ì…˜ì€ `feature/ì´ìŠˆ_í‹°ì¼“_ë²ˆí˜¸` ì˜ í˜•íƒœë¥¼ ì§€í‚¨ë‹¤. ì´ í¬ìŠ¤íŒ…ì—ì„œëŠ” ë¸Œëœì¹˜ ì´ë¦„ì—ì„œ ì´ìŠˆ í‹°ì¼“ ë²ˆí˜¸ë§Œ ê°€ì ¸ì™€ ì»¤ë°‹ ë©”ì‹œì§€ì— `[#ì´ìŠˆ_í‹°ì¼“_ë²ˆí˜¸]` í˜•íƒœë¡œ Prefixë¥¼ ì‚½ì…í•˜ëŠ” ê²ƒì„ ëª©í‘œë¡œ í•œë‹¤. ë‹¨ê³„ë³„ë¡œ prepare-commit-msg í›…ì„ ì‘ì„±í•´ë³´ë©° ëª©í‘œë¥¼ ë‹¬ì„±í•´ë³´ì.

> ê¸€ì„ ì½ëŠ” ì—¬ëŸ¬ë¶„ì˜ ì»¨ë²¤ì…˜ì´ ë‹¤ë¥´ë‹¤ë©´, ì•„ë˜ ë‚´ìš©ì„ ì‘ìš©í•˜ì—¬ ìì‹ ë§Œì˜ í›…ì„ ì‘ì„±í•˜ë©´ ë˜ê² ë‹¤. ì‘ì„±í•˜ê²Œ ë  í›…ì€ ì»¤ë°‹ ë©”ì‹œì§€ì˜ Prefixë¥¼ ë¸Œëœì¹˜ ì´ë¦„ìœ¼ë¡œë¶€í„° ê°€ì ¸ì˜¤ë¯€ë¡œ, í˜¹ì‹œ ë¸Œëœì¹˜ ì´ë¦„ì— ì´ìŠˆ í‹°ì¼“ ë²ˆí˜¸ê°€ í¬í•¨ë˜ì–´ ìˆì§€ ì•Šë‹¤ë©´ ë‹¤ë¥¸ ë°©ë²•ì„ ì‚¬ìš©í•˜ê¸°ë¥¼ ê¶Œí•œë‹¤.

### íŒŒì¼ ìƒì„±í•˜ê¸°

ìš°ì„  `./git/hooks` ì— `prepare-commit-msg` íŒŒì¼ì„ ìƒì„±í•˜ì. Git HooksëŠ” ì‹¤í–‰ê°€ëŠ¥í•˜ì§€ ì•Šì€ ìŠ¤í¬ë¦½íŠ¸ëŠ” ì‹¤í–‰í•˜ì§€ ì•ŠëŠ”ë‹¤. ë”°ë¼ì„œ ë°©ê¸ˆ ìƒì„±í•œ íŒŒì¼ì— ì‹¤í–‰ ê¶Œí•œì„ ë¶€ì—¬í•´ì•¼í•œë‹¤.

```bash
chmod +x .git/hooks/prepare-commit-msg
```

### ì»¤ë°‹ ë©”ì‹œì§€ì— Prefix ë„£ê¸°

ìš°ì„  ì²«ë²ˆì§¸ ë‹¨ê³„ë¡œ `feat:` ì´ë¼ëŠ” ê³ ì •ëœ Prefixë¥¼ ì»¤ë°‹ ë©”ì‹œì§€ ì•ì— ì‚½ì…í•´ë³´ì. ì•„ë˜ëŠ” ê·¸ ì˜ˆì œì´ë‹¤.

```bash
#!/bin/bash

COMMIT_EDITMSG_FILE_PATH=$1
DEFAULT_COMMIT_MSG=$(cat $COMMIT_EDITMSG_FILE_PATH)
PRFIX="feat:"

echo "$PRFIX $DEFAULT_COMMIT_MSG" > $COMMIT_EDITMSG_FILE_PATH
```

- **Line 3**: Bash Shell ì—ì„œëŠ” ì»¤ë§¨ë“œ ë¼ì¸ìœ¼ë¡œ ì „ë‹¬ëœ ì¸ìë¥¼ `$n` ì˜ í˜•íƒœë¡œ ë°›ëŠ”ë‹¤. ì´ ë•Œ nì€ ì¸ìì˜ ìˆœì„œì´ë‹¤. ìœ„ì—ì„œ ì•Œì•„ë³´ì•˜ë“¯ `prepare-commit-msg` ì˜ ì²«ë²ˆì§¸ ì¸ìëŠ” COMMIT_EDITMSGì˜ íŒŒì¼ ì´ë¦„ì´ë‹¤. ì´ë¥¼ `COMMIT_EDITMSG_FILE_PATH` ì— ì €ì¥í•œë‹¤.
- **Line 4**: `$(command)` ì˜ í˜•íƒœë¥¼ ì‚¬ìš©í•˜ë©´, ì»¤ë§¨ë“œ ë¼ì¸ ëª…ë ¹ ê²°ê³¼ë¥¼ ë³€ìˆ˜ì— ì €ì¥í•  ìˆ˜ ìˆë‹¤. `cat` ì€ íŒŒì¼ ë‚´ìš©ì„ ì½ì–´ì™€ í‘œì¤€ ì¶œë ¥ìœ¼ë¡œ ë³´ë‚¸ë‹¤. ì¦‰ `COMMIT_EDITMSG` ì˜ íŒŒì¼ ë‚´ìš©ì„ ì½ì–´ì™€ `DEFAULT_COMMIT_MSG` ì— ì €ì¥í•  ìˆ˜ ìˆë‹¤.
- **Line 5**: PREFIX ë³€ìˆ˜ì—ëŠ” ì»¤ë°‹ ë©”ì‹œì§€ Prefix ë¡œ ì‚¬ìš©í•  `feat:` ì´ë¼ëŠ” ë¬¸ìì—´ì„ ë¯¸ë¦¬ ì €ì¥í•œë‹¤.
- **Line 7**: `echo` ëŠ” í‘œì¤€ ì¶œë ¥ì„ ë§Œë“ ë‹¤. `>` ëŠ” Redirection ë¼ê³  ë¶ˆë¦¬ë©°, í‘œì¤€ ì¶œë ¥ì„ íŒŒì¼ì˜ ì…ë ¥ìœ¼ë¡œ ë³€ê²½í•  ìˆ˜ ìˆë‹¤ ([ê´€ë ¨ í¬ìŠ¤íŒ…](https://hudi.blog/linux-standard-stream-redirection-pipe/)). ì¦‰, `PREFIX` ë³€ìˆ˜ ê°’ê³¼ ê¸°ì¡´ `COMMIT_EDITMSG` íŒŒì¼ ë‚´ìš©ì„ í•©ì³ `COMMIT_EDITMSG` ì— ë®ì–´ ì”Œìš°ê²Œ ëœë‹¤.

![prefixê°€ ì˜ ë¶™ëŠ”ë‹¤](./3.png)

ìœ„ì™€ ê°™ì´ í›…ì„ ì‘ì„±í•˜ê³  ì»¤ë°‹ì„ ì‹œë„í•˜ë©´, ìœ„ ì‚¬ì§„ê³¼ ê°™ì´ ì»¤ë°‹ ë©”ì‹œì§€ì— ìë™ìœ¼ë¡œ `feat:` ì´ë¼ëŠ” prefixê°€ ìƒì„±ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì„ ê²ƒì´ë‹¤.

### ë¸Œëœì¹˜ ì´ë¦„ì—ì„œ Prefix ê°€ì ¸ì˜¤ê¸°

```bash
#!/bin/bash

COMMIT_EDITMSG_FILE_PATH=$1
DEFAULT_COMMIT_MSG=$(cat $COMMIT_EDITMSG_FILE_PATH)

CURRENT_BRANCH_NAME=$(git rev-parse --abbrev-ref HEAD)
ISSUE_TICKET=$(echo "$CURRENT_BRANCH_NAME" | sed 's/.*\///')

echo "[#$ISSUE_TICKET] $DEFAULT_COMMIT_MSG" > $COMMIT_EDITMSG_FILE_PATH
```

- **Line 6**: `git rev-parse` ëª…ë ¹ì€ íŠ¹ì • ì»¤ë°‹ í˜¹ì€ ë¸Œëœì¹˜ì— ëŒ€í•œ ì •ë³´ë¥¼ ì–»ê¸° ìœ„í•´ ì‚¬ìš©ëœë‹¤. ì˜ˆë¥¼ ë“¤ì–´ `git rev-parse HEAD` ëª…ë ¹ì€ í˜„ì¬ ë¸Œëœì¹˜ì˜ ê°€ì¥ ë§ˆì§€ë§‰ ì»¤ë°‹ì˜ Hashë¥¼ ì–»ì–´ì˜¨ë‹¤. ì—¬ê¸°ì—ì„œ `--abrev-ref` ì˜µì…˜ì„ ì‚¬ìš©í•˜ë©´ í˜„ì¬ ë¸Œëœì¹˜ ì´ë¦„ì„ ì–»ì–´ì˜¬ ìˆ˜ ìˆë‹¤. ì´ë ‡ê²Œ ì–»ì–´ì˜¨ ë¸Œëœì¹˜ ì´ë¦„ì„ `CUREENT_BRANCH_NAME` ë³€ìˆ˜ì— ì €ì¥í•œë‹¤.
- **Line 7**: ì´ìŠˆ í‹°ì¼“ ë²ˆí˜¸ë¥¼ `sed` ëª…ë ¹ì„ í†µí•´ ê°€ì ¸ì˜¨ ë¸Œëœì¹˜ ì´ë¦„ìœ¼ë¡œë¶€í„° ì¶”ì¶œí•œë‹¤. `sed` ëª…ë ¹ ì¤‘ì—ì„œë„ `s` (switch) ëª…ë ¹ì„ ì‚¬ìš©í–ˆëŠ”ë°, ì´ëŠ” íŠ¹ì • íŒ¨í„´ì— ì¼ì¹˜í•˜ëŠ” ë¬¸ìì—´ì„ ë‹¤ë¥¸ ë¬¸ìì—´ë¡œ ì¹˜í™˜í•˜ëŠ”ë° ì‚¬ìš©ëœë‹¤.
  `s` ëª…ë ¹ì€ `s/íŒ¨í„´/ì¹˜í™˜í• ë¬¸ì/` í˜•íƒœë¡œ ì‚¬ìš©í•œë‹¤. íŒ¨í„´ì—ëŠ” ì •ê·œì‹ì´ ì‚¬ìš©ëœë‹¤. ì •ê·œì‹ íŒ¨í„´ìœ¼ë¡œëŠ” `.*\/` ì„ ì‚¬ìš©í–ˆëŠ”ë°, ì´ íŒ¨í„´ì€ `/` ë¡œ ëë‚˜ëŠ” ëª¨ë“  ë¬¸ìì—´ê³¼ ë§¤ì¹­ëœë‹¤. ì¦‰, `sed 's/.*\///'` ëª…ë ¹ì€ `/` ë¡œ ëë‚˜ëŠ” ëª¨ë“  ë¬¸ìì—´ì„ ë¹ˆ ë¬¸ìì—´ë¡œ ì¹˜í™˜í•¨ìœ¼ë¡œì¨, `feature/123` ê³¼ ê°™ì€ ë¬¸ìì—´ì„ `123` ìœ¼ë¡œ ë§Œë“¤ ìˆ˜ ìˆë‹¤. ì´ë¥¼ í†µí•´ ì´ìŠˆ í‹°ì¼“ ë²ˆí˜¸ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.

![prefixë¡œ ì´ìŠˆ í‹°ì¼“ ë²ˆí˜¸ê°€ ì˜ ì„¤ì •ëœë‹¤](./4.png)

ì ì´ì œ ìë™ìœ¼ë¡œ ì´ìŠˆ í‹°ì¼“ ë²ˆí˜¸ë¥¼ ì»¤ë°‹ ë©”ì‹œì§€ì˜ Prefixë¡œ ì„¤ì •í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆë‹¤.

### Merge Commit ì€ ì œì™¸í•˜ê¸°

![Merge commit ì—ë„ ì‚½ì…ë˜ëŠ” prefix](./5.png)

ê·¸ëŸ°ë° ì•„ì§ ë¬¸ì œê°€ ì¡´ì¬í•œë‹¤. ìš°ë¦¬ê°€ ì‘ì„±í•œ ìŠ¤í¬ë¦½íŠ¸ëŠ” ìœ„ì™€ ê°™ì´ Merge commitì—ë„ ì ìš©ëœë‹¤. ì´ëŠ” ì œê±°í•˜ëŠ”ê²Œ ì¢‹ì„ ê²ƒ ê°™ë‹¤. ì•„ë˜ì™€ ê°™ì´ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ê°œì„ í•˜ì.

```bash
#!/bin/bash

COMMIT_EDITMSG_FILE_PATH=$1
DEFAULT_COMMIT_MSG=$(cat $COMMIT_EDITMSG_FILE_PATH)

CURRENT_BRANCH_NAME=$(git rev-parse --abbrev-ref HEAD)
ISSUE_TICKET=$(echo "$CURRENT_BRANCH_NAME" | sed 's/.*\///')

COMMIT_SOURCE=$2
if [ "$COMMIT_SOURCE" != "merge" ]; then
  PREFIX="[#$ISSUE_TICKET] "
fi

echo "$PREFIX$DEFAULT_COMMIT_MSG" > $COMMIT_EDITMSG_FILE_PATH
```

- **Line 9~12**: prepare-commit-msgì˜ ë‘ë²ˆì§¸ ì¸ì ì¦‰, ì»¤ë°‹ ë©”ì‹œì§€ ì¶œì²˜ê°€ `merge` ê°€ ì•„ë‹ˆë¼ë©´ `PREFIX` ë³€ìˆ˜ë¥¼ ì„¤ì •í•œë‹¤. `merge` ì¼ ê²½ìš°ì—ëŠ” `PREFIX` ë³€ìˆ˜ê°€ ê³µë°±ì¼ ê²ƒì´ë¯€ë¡œ í›…ì´ ì‹¤í–‰ ë˜ë”ë¼ë„ ì»¤ë°‹ ë©”ì‹œì§€ëŠ” ì›ë³¸ê³¼ ë™ì¼í•  ê²ƒì´ë‹¤.

![Merge commitì—ëŠ” prefixê°€ ë¶™ì§€ ì•ŠëŠ”ë‹¤](./6.png)

ìœ„ì˜ ê°œì„  ì‘ì—…ê¹Œì§€ ê±°ì¹˜ë©´, ìœ„ì™€ ê°™ì´ ë¨¸ì§€ ì»¤ë°‹ì€ ê¹”ë”í•˜ê²Œ ì›ë³¸ ê·¸ëŒ€ë¡œ ì„¤ì •ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì„ ê²ƒì´ë‹¤.

## ì°¸ê³ 

- https://www.atlassian.com/ko/git/tutorials/git-hooks
- https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks
- https://git-scm.com/docs/githooks#_prepare_commit_msg
- https://blog.gitnux.com/code/git-rev-parse/
